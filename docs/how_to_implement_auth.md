# ログイン機能

ログイン機能を使いたいチームもいくつかあると予想していますが、実装は大変なので、あらかじめこちらで準備したものを使ってもらうこともできます。

> [!Important]
>
> ここでのログイン機能の実装はあくまでもデモ可能なレベルのものであって、例えばプロダクション環境で使えるレベルのセキュリティなどを保証するものではありません。あまり信用しないでね。

## 追加方法

ログイン機能を追加したい場合、各種ページへのリンクを追加することで簡単に追加できます。

1. `src/web/templates/index.html` を開きます。
1. 適切な場所に以下のようなリンクを追加します：

   ```html
   <a href="{{ url_for('app.auth.login') }}">ログイン</a>
   <a href="{{ url_for('app.auth.signup') }}">新規登録</a>
   ```

   また、ログアウトリンクを作りたい場合は以下のようにしてください。

   ```html
   <a href="{{ url_for('app.auth.logout') }}">ログアウト</a>
   ```

1. 必要に応じて、`src/web/auth/templates/login.html` と `src/web/auth/templates/signup.html` を編集してログインと新規登録フォームのデザインをカスタマイズします。

## ログインを必須にするページの作り方

`src/web/routes.py` の `secret()` を参考にしてください。
基本的には関数に `@login_required` をつけることで、非ログイン状態からログイン状態に遷移することができます。

> [!Important]
>
> Flask の技術的制約により、ホットリロードが発生するたびにログインセッションが切れます。したがってホットリロードを多用して画面をデザインしている間は一旦 `@login_required` をつけずに進めることをおすすめします。その方法については `secret()` のコメントを参考にしてください。

## ログイン後のリダイレクト先ページについて

デフォルトではログイン後 index.html ページに飛びますが、リンク先を `/auth/login?next=リダイレクト先のパス` というふうに指定してあげることで、ログイン後にそのページにリダイレクトさせるようなログインリンクを作ることができます (リダイレクト先のパスを％エンコーディングすることを忘れないでください) 。`@login_required` によって遷移した場合も `next` パラメータで本来の URL を指定しているので、ログイン後は見たかったページに自動的にリダイレクトされます。
